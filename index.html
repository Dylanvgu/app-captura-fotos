<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Captura de Fotos</title>
  <style>
    body { font-family: Arial; text-align: center; margin: 20px; }
    video, canvas, img { max-width: 100%; margin-top: 10px; }
    select, button { padding: 10px; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Captura de Fotos</h2>

  <label for="persona">Selecciona tu nombre:</label><br>
  <select id="persona">
    <option value="Andrea">Andrea</option>
    <option value="rita">Rita</option>
    <option value="nayra">Nayra</option>
    <option value="jorge">Jorge</option>
    <option value="jorgec">Jorge C</option>
    <option value="mercadeo">Mercadeo</option>
    <option value="leandro">Leandro</option>
    <option value="Dylan">Dylan</option>
    <option value="jonathan">Jonathan</option>
  </select><br>

  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" style="display:none;"></canvas>
  <img id="preview" alt="Preview"><br>

  <button onclick="tomarFoto()">Tomar Foto</button>

  <p id="mensaje"></p>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const preview = document.getElementById('preview');
    const mensaje = document.getElementById('mensaje');
    const persona = document.getElementById('persona');

    // Solicita cámara trasera
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
      .then(stream => { video.srcObject = stream; })
      .catch(err => { mensaje.textContent = "Error accediendo a la cámara: " + err; });

    function tomarFoto() {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext('2d').drawImage(video, 0, 0);
      const imageBase64 = canvas.toDataURL("image/jpeg");
      preview.src = imageBase64;
      mensaje.textContent = "Subiendo imagen...";

      const data = {
        carpeta: persona.value,
        nombre: "foto_" + Date.now(),
        image: imageBase64
      };

      fetch('https://script.google.com/macros/s/AKfycbyRXdSd2-6fhs1DT34qjpTKY8LRw9iONzyTjmVvSKRKZC72-1Al4Gh75fmtBNy8cfUN1w/exec', {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(json => {
        if (json.status === "success") {
          mensaje.textContent = json.message;
        } else {
          mensaje.textContent = "Error: " + json.message;
        }
      })
      .catch(err => {
        mensaje.textContent = "Error al subir: " + err;
      });
    }
  </script>
</body>
</html>
